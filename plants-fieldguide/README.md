# Plants FieldGuide

Plants FieldGuide is an AI-powered CLI assistant for the USDA PLANTS Help documentation. It processes PDF documentation, creates semantic embeddings, and enables natural language Q&A about plant database features through a conversational interface. Built with RAG (Retrieval-Augmented Generation) architecture, it combines vector search with LLM reasoning to provide accurate, context-aware answers about the PLANTS database.

## Learning Objectives

This project demonstrates several concepts for building RAG systems:

- **PDF Processing & Text Extraction** - Extracting structured text from PDF documents with section detection and intelligent chunking strategies
- **Vector Embeddings & Semantic Search** - Using transformer models to generate embeddings and HNSW indexes for efficient similarity search
- **RAG Architecture** - Combining retrieval-based context with LLM generation for accurate, grounded responses
- **Spec-Driven Agent Design** - Building modular AI agents using YAML specifications for prompts, inputs, and outputs
- **Document Chunking Strategies** - Implementing overlap-based chunking with section awareness for better context preservation
- **Embedding Generation at Scale** - Batching and progress tracking for processing large document collections

## Tech Stack

| Layer | Technology | Notes |
|-------|------------|-------|
| Runtime | Node.js | ES2022 modules |
| Language | TypeScript | Strict mode |
| LLM | Anthropic Claude | `@anthropic-ai/sdk` |
| Embeddings | OpenAI / Transformers.js | `@xenova/transformers` for local embeddings |
| Vector Store | HNSWLib | `hnswlib-node` for fast similarity search |
| PDF Processing | pdf2json | Text extraction from PDF documents |
| CLI Framework | Commander.js | Command-line interface |
| Terminal UI | Ora + Chalk | Spinners and colored output |

## Project Structure

```
src/
├── cli.ts              # CLI entry point with command definitions
├── index.ts            # Package exports
├── types/
│   ├── document.ts     # Document chunk and metadata types
│   └── spec.ts         # Agent specification types
├── agents/
│   └── spec-executor.ts # Agent executor for running YAML specs
├── commands/
│   ├── index.ts        # Index PDF documents
│   ├── ask.ts          # Ask questions about documentation
│   ├── debug.ts        # Debug PDF processing
│   └── specs.ts        # List available agent specs
└── utils/
    ├── pdf-processor.ts   # PDF text extraction and chunking
    ├── embeddings.ts      # Embedding generation
    ├── vector-store.ts    # HNSW vector index management
    └── spec-loader.ts     # Load agent specs from YAML

specs/
├── agents/             # Agent specification files (YAML)
├── prompts/            # Reusable prompt templates
├── tools/              # Tool definitions
└── workflows/          # Multi-agent workflows

data/                   # Generated embeddings and indexes
dist/                   # Compiled JavaScript (generated by npm run build)
```

## Getting Started

**Prerequisites:**

Before running FieldGuide, you need to configure API keys:

1. Copy `.env.example` to `.env`:
   ```bash
   cp .env.example .env
   ```

2. Get your API keys:
   - **Anthropic API Key**: https://console.anthropic.com/
   - **OpenAI API Key**: https://platform.openai.com/api-keys (for embeddings)

3. Add the keys to your `.env` file:
   ```bash
   ANTHROPIC_API_KEY=your_key_here
   OPENAI_API_KEY=your_openai_key_here
   ```

**Installation:**

```bash
# Install dependencies
npm install

# Index the PLANTS documentation (required first time)
npm run cli -- index

# Ask a question
npm run cli -- ask "How do I search for plants?"
```

**Global Installation (optional):**
```bash
# Build and install globally
npm run build
npm install -g .

# Run from any directory
fieldguide ask "How do I use the plant search?"
```

## Commands

### Index Documentation
Process a PDF and create vector embeddings:

```bash
# Index with default settings
npm run cli -- index

# Custom chunk size and overlap
npm run cli -- index --chunk-size 2000 --chunk-overlap 400

# Index a different PDF file
npm run cli -- index --file ./path/to/document.pdf

# Verbose output with timing details
npm run cli -- index --verbose
```

### Ask Questions
Query the indexed documentation:

```bash
# Make sure you've indexed the documentation first
npm run cli -- index

# Ask questions using the document-retriever agent
npm run cli -- ask "What are wetland indicators?" --agent document-retriever

# Try different question types
npm run cli -- ask "How do I search for plants by state?" --agent document-retriever
npm run cli -- ask "What does the symbol FACW mean?" --agent document-retriever
npm run cli -- ask "Explain the difference between native and introduced plants" --agent document-retriever

# Use verbose mode to see detailed output
npm run cli -- ask "What is ethnobotany?" --agent document-retriever --verbose

# Use the greeter agent for a friendly introduction
npm run cli -- ask "Hello!" --agent greeter

# Direct search mode (no AI, just vector search results)
npm run cli -- ask "taxonomy" --direct
```

### Debug PDF Processing
Analyze PDF structure and estimate processing time:

```bash
# Debug default PDF
npm run cli -- debug

# Debug a specific file
npm run cli -- debug --file ./custom.pdf
```

### List Agent Specs
View available AI agents:

```bash
npm run cli -- specs
```

## Spec-Driven Agent Design

FieldGuide uses YAML-based agent specifications for modular AI behavior:

- `specs/agents/` - Agent definitions with prompts and schemas
- `specs/prompts/` - Reusable prompt templates
- `specs/tools/` - Tool specifications
- `specs/workflows/` - Multi-agent workflows

**Example Agent Spec Structure:**
```yaml
metadata:
  name: question-analyzer
  version: 1.0.0
  description: Analyzes user questions and retrieves relevant context

input_schema:
  question: string
  context: string[]

system_prompt: |
  You are an expert assistant for the PLANTS database...

model:
  provider: anthropic
  name: claude-3-5-sonnet-20241022
  temperature: 0.7
  max_tokens: 2000
```

## Architecture

### RAG Pipeline

```
1. Indexing Phase:
   a. Extract text from PDF (pdf2json)
   b. Detect sections and create chunks
   c. Generate embeddings (OpenAI/Transformers.js)
   d. Build HNSW vector index
   e. Save to disk

2. Query Phase:
   a. User asks question via CLI
   b. Generate query embedding
   c. Vector search for top-k similar chunks
   d. Retrieve chunk content + metadata
   e. Pass to Claude with context
   f. Stream response to user
```

### Document Processing

- **Section Detection** - Identifies document structure (headings, chapters)
- **Smart Chunking** - Respects section boundaries, configurable overlap
- **Metadata Preservation** - Tracks page numbers, sections, chunk positions
- **Page Assignment** - Maps chunks back to original PDF pages

### Vector Store

- **HNSW Algorithm** - Fast approximate nearest neighbor search
- **Persistent Storage** - Save/load indexes from disk
- **Batch Operations** - Efficient bulk insertion and updates
- **Metadata Tracking** - Store document metadata with vectors

## Development

**Development Mode:**
```bash
npm run dev          # Watch mode with auto-restart
npm run cli -- <cmd> # Run specific command
npm run typecheck    # Type checking without build
```

**Build:**
```bash
npm run build        # Compile TypeScript to dist/
```

**Testing:**
```bash
npm test            # Run test suite (vitest)
```

## Conventions

### Code Style
- ES modules only (`"type": "module"`)
- TypeScript strict mode
- Async/await for all I/O operations

### File Naming
- camelCase for TypeScript files: `pdfProcessor.ts`
- kebab-case for CLI commands: `debug.ts`

### TypeScript
- Target: ES2021
- Module: ES2022
- Strict type checking enabled
- Explicit return types for public APIs

## License

MIT
